<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ΗΜΤΥ Μ.Ο.</title>
    <link rel="stylesheet" href="style.css">
    

</head>

<body>
    <main>
        <!-- title, text etc. -->

        <h1>ΗΜΤΥ Μ.Ο. </h1>

        <h4>Το παρακάτω πρόγραμμα υπολογίζει τον νέο Μ.Ο. σου αν περάσεις όσα μαθήματα θες ή/και την διπλωματική,
            ανάλογα με τον συντελεστή και τον βαθμό τους. Μπορείς να δεις τους συντελεστές των μαθημάτων στο progress.
            (Κάνε refresh για να μηδενιστούν οι τιμές).</h4>

        <ul>
            <li>Τα μαθήματα χωρίς εργαστήριο έχουν συντελεστή βαρύτητας 1.5 (το εργαστήριο φυσικής έχει 1 αλλά είναι
                αμελητέα η διαφορά για ένα μάθημα, θεωρείστε ότι έχει συντελεστή 1.5).</li>
            <li>Μαθήματα με εργαστήριο ή μαθήματα με 5 ώρες θεωρίας (π.χ. Λογισμός 1, Μικροηλεκτρονικές, ΜΔΕ κλπ.) έχουν
                συντελεστή 2.</li>
            <li>Ομοίως για τα μαθήματα των κατευθύνσεων.</li>
            <li>(Για τα 3 πρώτα έτη: 11 μαθήματα με συντελεστή 2 και  27 με συντελεστή 1.5)</li>
        </ul>
        <!-- form -->
        <form action="submit">
            <label for="fileinput">Εδώ μπορείς να εισάγεις το αρχείο WDP.xls της αναλυτικής βαθμολογίας από το κουμπί "export" στο Progress για να συμπληρωθούν αυτόματα τα παρακάτω πεδία: </label>
            <input type="file" id="fileinput" accept=".xls"/>

            <!-- Περασμένα μαθήματα -->
            <div class="input">
                <label for="lessons1">Αριθμός περασμένων μαθημάτων με συντελεστή 1.5: </label>
                <input type="number" placeholder="0" name="lessons1" min="0" max="39" required id="lessons1">
            </div>
            <div class="input">
                <label for="lessons2">Αριθμός περασμένων μαθημάτων με συντελεστή 2: </label>
                <input type="number" placeholder="0" name="lessons2" min="0" max="27" required id="lessons2">
            </div>
            <div class="input">
                <label for="mo">Τωρινός M.O. πτυχίου (Progress -> Ακαδημαϊκό έργο, κάτω μέρος): </label>
                <input type="number" placeholder="0" name="mo" min="5.0" max="10.0" step = "0.5" required id="mo">
            </div>

            <div id="line"></div>

            <!-- Ζητούμενα μαθήματα -->
            <div class="input" id="input1">
                <label for="metavolh1">-> Βαθμός μαθήματος με συντελεστή 1.5: </label>
                <input type="number" placeholder="0" name="input1" min="5.0" max="10.0" step = "0.5" required id="metavolh1">
                <button type="button" onclick="addLesson(1.5)" class="add">+</button>
            </div>
            <div class="input" id="input2">
                <label for="metavolh2">-> Βαθμός μαθήματος με συντελεστή 2: </label>
                <input type="number" placeholder="0" name="input2" min="5.0" max="10.0" step = "0.5" required id="metavolh2">
                <button type="button" onclick="addLesson(2)" class="add">+</button>
            </div>
            <div class="input">
                <label for="thesis">-> Βαθμός διπλωματικής (συντελεστής 15): </label>
                <input id="input3" type="number" placeholder="0" name="thesis" min="5.0" max="10.0" step = "0.5" required id="thesis">
            </div>

            <!-- Submit button -->
            <button type="button" onclick="getMO()" class="btn">Υπολογισμός Νέου Μ.Ο.</button>
        </form>
    </main>
    <!-- footer -->
    <script src="script.js"></script>
    <p>&copy; Γενναίος Λυκουργιώτης & Ιωάννης Τσάμπρας - Αιχμή του δόρατος, 2023
    <article>Η ειλικρίνεια είναι σαν το λουλούδι</article>
    </p>
</body>
<script type="text/javascript">
    function readSingleFile(evt) {
        var f = evt.target.files[0];   
        if (f) {
        var r = new FileReader();
        r.onload = function(e) { 
            var contents = e.target.result;             
            var ct = r.result;
            var words = ct.split(' ');  //this is not needed

            let input_file_as_text = words.join(); //this is bullshit
            //input_file_as_text = input_file_as_text
            input_file_as_text=input_file_as_text.replace("\n"," "); //remove newline characters
            const regex = /.*([5-9]|10),(0|5).*2.*(1,5|2,0|1,0)/g; // basically match a passing grade (e.g. 8,5 or 10,0 or 5,0) followed by anything and then a "2" (the 2022 following grades in a line, this is to differentiate from other random text that follows thsi pattern) then followed by anything and finally followed by one of 1,0 1,5 1,2
            const found = input_file_as_text.match(regex); //find matches for pattern
            console.log(found.length);
            let grade_sum=0;
            let weight_sum=0;
            let lessons1=0;
            let lessons2=0;

            for(let i=0;i<found.length;i++){
                
                line=found[i].replace(/[\u0009]/g," "); //replace control character to space for spliting later
                let grade= line.split(" ")[5].replace(",","."); //get 6.5 from 6,5
                
                let weight = line.split(",,").at(-1).replace(",",".");

                console.log(i+" "+grade+" "+weight);


                english="ECE_ΞΓ210";
                if(line.includes(english)){ //ignore english
                    console.log("ignoring english")
                    grade=0;
                    weight=0;
                }
                if(weight==1.5 || weight==1.0){
                    lessons1=lessons1+1;
                }
                if(weight==2.0){
                    lessons2=lessons2+1;
                }
                
                grade_sum=grade_sum+parseFloat(grade*weight);
                weight_sum=weight_sum+parseFloat(weight);
                //console.log(weight_sum);

            }
            console.log(grade_sum/weight_sum);
            let average=Math.round(100*grade_sum/weight_sum)/100;
            document.getElementById("lessons1").value=lessons1;
            document.getElementById("lessons2").value=lessons2;
            document.getElementById("mo").value=average;
        
            
        }
        r.readAsText(f,"CP1253");
        } else { 
        alert("Failed to load file");
        }
    }

    document.getElementById('fileinput').addEventListener('change', readSingleFile, false);
    </script>

</html>
